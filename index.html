<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Wedding Day</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        /* Custom background for hero section */
        .hero-background {
            background-image: url('https://placehold.co/1920x1080/F0F0F0/6c757d?text=Beautiful+Wedding+Background'); /* Placeholder image */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 text-gray-800">

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h3 class="text-2xl font-bold mb-4" id="modalTitle"></h3>
            <p class="mb-6" id="modalMessage"></p>
            <div id="modalActions" class="flex justify-center space-x-4">
                <button id="modalConfirmBtn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-full transition duration-300">Confirm</button>
                <button id="modalCancelBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-full transition duration-300">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50 rounded-b-xl">
        <nav class="container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center">
            <a href="#" class="text-3xl font-bold text-pink-600 hover:text-purple-700 transition duration-300 mb-2 sm:mb-0">Chamodi & Diyanada</a>
            <ul class="flex space-x-6 text-lg">
                <li><a href="#home" class="text-gray-700 hover:text-pink-600 transition duration-300 py-2 px-3 rounded-full hover:bg-pink-100">Home</a></li>
                <li><a href="#story" class="text-gray-700 hover:text-pink-600 transition duration-300 py-2 px-3 rounded-full hover:bg-pink-100">Our Story</a></li>
                <li><a href="#details" class="text-gray-700 hover:text-pink-600 transition duration-300 py-2 px-3 rounded-full hover:bg-pink-100">Details</a></li>
                <li><a href="#rsvp" class="text-gray-700 hover:text-pink-600 transition duration-300 py-2 px-3 rounded-full hover:bg-pink-100">RSVP</a></li>
                <li><a href="#gallery" class="text-gray-700 hover:text-pink-600 transition duration-300 py-2 px-3 rounded-full hover:bg-pink-100">Gallery</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero-background min-h-screen flex items-center justify-center text-white text-center py-20 px-4">
        <div class="bg-black bg-opacity-40 p-8 md:p-12 rounded-2xl shadow-2xl max-w-4xl mx-auto backdrop-blur-sm">
            <h1 class="text-5xl md:text-7xl font-bold mb-4 animate-fade-in-down">Chamodi Mihirangi & Diyanada Gunawardena</h1>
            <p class="text-2xl md:text-3xl mb-8 tracking-wide animate-fade-in-up">Together with their families, Joyfully request the honour of your presence at the celebration of their marriage.</p>
            <p class="text-xl md:text-2xl font-light mb-10 animate-fade-in-up">Saturday, January 28, 2026 | Hikka Tranz by Cinnamon, Hikkaduwa</p>
            <a href="#rsvp" class="inline-block bg-pink-600 hover:bg-pink-700 text-white font-semibold py-4 px-10 rounded-full shadow-lg transition duration-300 transform hover:scale-105 animate-bounce-in">RSVP Now</a>
        </div>
    </section>

    <!-- Our Story Section -->
    <section id="story" class="py-20 px-4 bg-white rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">Our Story</h2>
            <div class="grid md:grid-cols-2 gap-10 items-center">
                <div class="text-left leading-relaxed">
                    <h3 class="text-2xl font-semibold text-pink-600 mb-4">How We Met</h3>
                    <p class="mb-4">It all started on a serendipitous spring evening in a cozy coffee shop. Chamodi, engrossed in a novel, barely noticed Diyanada stumble in, juggling a stack of books and a steaming latte. A spilled drink, a shared laugh, and an instant connection followed. They talked for hours, realizing they had a mutual love for classic literature and adventurous hikes.</p>
                    <h3 class="text-2xl font-semibold text-pink-600 mb-4 mt-8">The Proposal</h3>
                    <p>Years later, on their annual hiking trip to the majestic Rockies, Chamodi got down on one knee amidst breathtaking panoramic views. With the setting sun painting the sky in hues of orange and purple, he asked Diyanada to spend forever with him. Through tears of joy, she said "Yes!" and the mountains echoed their happiness.</p>
                </div>
                <div class="flex justify-center">
                    <img src="https://placehold.co/500x350/E0BBE4/FFFFFF?text=Couple+Photo" alt="Our Story" class="rounded-xl shadow-xl w-full max-w-md object-cover transform transition duration-500 hover:scale-105">
                </div>
            </div>
        </div>
    </section>

    <!-- Event Details Section -->
    <section id="details" class="py-20 px-4 bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">Event Details</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-xl shadow-lg border-b-4 border-pink-500 transform transition duration-300 hover:scale-105">
                    <h3 class="text-2xl font-semibold text-pink-600 mb-4">Ceremony</h3>
                    <p class="text-lg mb-2"><strong>Date:</strong> Saturday, January 28, 2026</p>
                    <p class="text-lg mb-2"><strong>Time:</strong> Poruwa Ceremony at 9:30 AM | Wedding Ceremony at 10:30 AM</p>
                    <p class="text-lg"><strong>Location:</strong> Hikka Tranz by Cinnamon, Hikkaduwa</p>
                    <p class="text-sm text-gray-500 mt-2">Formal attire requested.</p>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg border-b-4 border-purple-500 transform transition duration-300 hover:scale-105">
                    <h3 class="text-2xl font-semibold text-purple-600 mb-4">Reception</h3>
                    <p class="text-lg mb-2">Following the sacred ceremony, we warmly invite you to join us for a reception of love, joy, and togetherness.</p>
                    <p class="text-lg">Your gracious presence will be deeply cherished as we begin our new journey in life.</p>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg border-b-4 border-pink-500 transform transition duration-300 hover:scale-105">
                    <h3 class="text-2xl font-semibold text-pink-600 mb-4">Directions</h3>
                    <p class="text-lg mb-4">Easily find your way to our special day.</p>
                    <!-- Placeholder for an embedded map -->
                    <div class="bg-gray-200 h-40 rounded-lg flex items-center justify-center text-gray-500">
                        <p>Map Placeholder</p>
                        <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d... etc" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe> -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RSVP Section -->
    <section id="rsvp" class="py-20 px-4 bg-white rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">RSVP</h2>
            <p class="text-lg mb-8">Kindly RSVP by Monday, January 12, 2026.</p>
            <form class="max-w-md mx-auto bg-gray-50 p-8 rounded-xl shadow-lg border-t-4 border-pink-500">
                <div class="mb-6 text-left">
                    <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Your Name(s):</label>
                    <input type="text" id="name" name="name" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-300" placeholder="Chamodi & Diyanada" required>
                </div>
                <div class="mb-6 text-left">
                    <label for="attending" class="block text-gray-700 text-sm font-bold mb-2">Will you be attending?</label>
                    <select id="attending" name="attending" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-300" required>
                        <option value="">Please Select</option>
                        <option value="yes">Joyfully accept</option>
                        <option value="no">Regretfully decline</option>
                    </select>
                </div>
                <div class="mb-6 text-left">
                    <label for="guests" class="block text-gray-700 text-sm font-bold mb-2">Number of Guests (including yourself):</label>
                    <input type="number" id="guests" name="guests" min="1" max="6" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-300" value="1" required>
                </div>
                <div class="mb-6 text-left">
                    <label for="message" class="block text-gray-700 text-sm font-bold mb-2">Your Message (optional):</label>
                    <textarea id="message" name="message" rows="4" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-pink-300" placeholder="Any dietary restrictions or a lovely message for the couple..."></textarea>
                </div>
                <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 transform hover:scale-105">Submit RSVP</button>
            </form>
            <div class="mt-8 text-lg text-gray-700">
                <p><strong>Contact Us:</strong></p>
                <p>Diyanada: <a href="tel:+94713196876" class="text-pink-600 hover:underline">+94 71 319 6876</a></p>
                <p>Chamodi: <a href="tel:+94707436339" class="text-pink-600 hover:underline">+94 70 743 6339</a></p>
            </div>
        </div>
    </section>

    <!-- Gift Registry Section -->
    <section id="registry" class="py-20 px-4 bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">Gift Registry</h2>
            <p class="text-lg mb-8">Your presence is our greatest gift! However, if you wish to honor us with a gift, we have registered at the following:</p>
            <div class="flex flex-wrap justify-center gap-6">
                <a href="#" class="block bg-white p-6 rounded-xl shadow-lg border-b-4 border-pink-400 transform transition duration-300 hover:scale-105 hover:shadow-xl w-full sm:w-64">
                    <img src="https://placehold.co/100x50/F8D7DA/818385?text=Registry+Logo" alt="Registry 1" class="mx-auto mb-4 rounded-md">
                    <h3 class="text-xl font-semibold text-pink-600">The Home Store</h3>
                    <p class="text-gray-600 mt-2">For household essentials.</p>
                </a>
                <a href="#" class="block bg-white p-6 rounded-xl shadow-lg border-b-4 border-purple-400 transform transition duration-300 hover:scale-105 hover:shadow-xl w-full sm:w-64">
                    <img src="https://placehold.co/100x50/D1E7DD/818385?text=Registry+Logo" alt="Registry 2" class="mx-auto mb-4 rounded-md">
                    <h3 class="text-xl font-semibold text-purple-600">Travel Fund</h3>
                    <p class="text-gray-600 mt-2">Help us achieve our dream honeymoon!</p>
                </a>
            </div>
        </div>
    </section>

    <!-- Photo Uploader Section -->
    <section id="photo-uploader" class="py-20 px-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">Share Your Moments!</h2>
            <p class="text-lg mb-8">We'd love to see your photos from our special day (or any day!). Upload your favorite memories here.</p>
            <div class="max-w-md mx-auto bg-gray-50 p-8 rounded-xl shadow-lg border-t-4 border-purple-500">
                <input type="file" id="photoFile" accept="image/*" class="hidden" onchange="displayFileName()">
                <label for="photoFile" class="block bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-8 rounded-full shadow-md cursor-pointer transition duration-300 transform hover:scale-105">
                    Choose Photo
                </label>
                <p id="fileName" class="mt-4 text-gray-700 italic"></p>
                <button id="uploadButton" onclick="uploadPhoto()" class="mt-6 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 transform hover:scale-105" disabled>
                    Upload Photo
                </button>
                <div id="uploadProgress" class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mt-4 hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%" id="progressBar"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section (now includes uploaded photos) -->
    <section id="gallery" class="py-20 px-4 bg-white rounded-xl shadow-inner mt-8 mx-auto max-w-5xl">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-purple-700 mb-10">Our Photo Gallery</h2>
            <p class="text-lg mb-8">A glimpse into our journey together and shared moments from our guests!</p>
            <div id="photoGallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Static photos -->
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/FFD1DC/6c757d?text=Photo+1" alt="Gallery Image 1" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Love Blooms</p>
                    </div>
                </div>
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/E0BBE4/6c757d?text=Photo+2" alt="Gallery Image 2" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Adventures Await</p>
                    </div>
                </div>
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/957DAD/6c757d?text=Photo+3" alt="Gallery Image 3" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Memories Made</p>
                    </div>
                </div>
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/CBAACB/6c757d?text=Photo+4" alt="Gallery Image 4" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Joyful Moments</p>
                    </div>
                </div>
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/FFC3A0/6c757d?text=Photo+5" alt="Gallery Image 5" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Side by Side</p>
                    </div>
                </div>
                <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                    <img src="https://placehold.co/600x400/FFADAD/6c757d?text=Photo+6" alt="Gallery Image 6" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-xl font-semibold">Our Future</p>
                    </div>
                </div>
                <!-- Uploaded photos will be loaded here dynamically -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-10 px-4 mt-8 rounded-t-xl">
        <div class="container mx-auto text-center">
            <p class="text-lg mb-4">&copy; 2026 Chamodi & Diyanada. All Rights Reserved.</p>
            <div class="flex justify-center space-x-6 text-2xl">
                <!-- Placeholder for social media icons -->
                <a href="#" class="hover:text-pink-400 transition duration-300">❤️</a>
                <a href="#" class="hover:text-pink-400 transition duration-300">✉️</a>
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Firebase Configuration - Provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let auth;
        let db;
        let storage;
        let currentUserId = null;
        let isAuthReady = false;

        // Initialize Firebase
        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);

            // Auth state listener
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUserId = user.uid;
                } else {
                    // Sign in anonymously if no user is found
                    try {
                        await signInAnonymously(auth);
                        currentUserId = auth.currentUser.uid;
                    } catch (error) {
                        console.error("Error signing in anonymously:", error);
                    }
                }
                isAuthReady = true;
                console.log("Firebase Auth Ready. User ID:", currentUserId);
                // Load photos once auth is ready
                loadPhotos();
            });

            // Sign in with custom token if available, otherwise anonymously
            (async () => {
                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } catch (error) {
                        console.error("Error signing in with custom token:", error);
                        // Fallback to anonymous if custom token fails
                        try {
                            await signInAnonymously(auth);
                        } catch (anonError) {
                            console.error("Error signing in anonymously as fallback:", anonError);
                        }
                    }
                } else {
                    try {
                        await signInAnonymously(auth);
                    } catch (error) {
                        console.error("Error signing in anonymously:", error);
                    }
                }
            })();

        } else {
            console.error("Firebase config not found. Photo uploader will not function.");
            document.getElementById('uploadButton').disabled = true;
        }

        const photoFile = document.getElementById('photoFile');
        const uploadButton = document.getElementById('uploadButton');
        const fileNameDisplay = document.getElementById('fileName');
        const uploadProgressBar = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const photoGallery = document.getElementById('photoGallery');

        // Function to display selected file name
        window.displayFileName = function() {
            if (photoFile.files.length > 0) {
                fileNameDisplay.textContent = `Selected: ${photoFile.files[0].name}`;
                uploadButton.disabled = false;
            } else {
                fileNameDisplay.textContent = '';
                uploadButton.disabled = true;
            }
        };

        // Function to show a custom modal for confirmation/messages
        function showModal(title, message, isConfirm = false, onConfirm = null) {
            const modal = document.getElementById('confirmationModal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;

            const modalActions = document.getElementById('modalActions');
            const confirmBtn = document.getElementById('modalConfirmBtn');
            const cancelBtn = document.getElementById('modalCancelBtn');

            if (isConfirm) {
                modalActions.style.display = 'flex';
                confirmBtn.onclick = () => {
                    if (onConfirm) onConfirm();
                    closeModal();
                };
                cancelBtn.onclick = () => closeModal();
            } else {
                modalActions.style.display = 'none';
            }
            modal.style.display = 'flex'; // Show modal
        }

        // Function to close the custom modal
        window.closeModal = function() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        // Upload photo function
        window.uploadPhoto = async function() {
            if (!isAuthReady || !currentUserId || !db || !storage) {
                showModal("Error", "Firebase is not ready. Please try again in a moment.");
                return;
            }

            const file = photoFile.files[0];
            if (!file) {
                showModal("Error", "Please select an image file to upload.");
                return;
            }

            const storageRef = ref(storage, `artifacts/${appId}/public/photos/${currentUserId}/${file.name}`);
            const uploadTask = uploadBytesResumable(storageRef, file);

            uploadProgressBar.classList.remove('hidden');
            uploadButton.disabled = true;

            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                    console.log('Upload is ' + progress + '% done');
                },
                (error) => {
                    console.error("Upload failed:", error);
                    showModal("Upload Failed", `Failed to upload image: ${error.message}`);
                    uploadProgressBar.classList.add('hidden');
                    uploadButton.disabled = false;
                },
                async () => {
                    try {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        console.log('File available at', downloadURL);

                        // Save photo metadata to Firestore
                        await addDoc(collection(db, `artifacts/${appId}/public/data/photos`), {
                            url: downloadURL,
                            uploaderId: currentUserId,
                            timestamp: serverTimestamp(),
                            fileName: file.name
                        });
                        showModal("Success", "Your photo has been uploaded successfully!");
                        photoFile.value = ''; // Clear file input
                        fileNameDisplay.textContent = '';
                        uploadProgressBar.classList.add('hidden');
                        uploadButton.disabled = true;
                    } catch (error) {
                        console.error("Error saving photo data to Firestore:", error);
                        showModal("Error", `Failed to save photo data: ${error.message}`);
                    }
                }
            );
        };

        // Load photos from Firestore
        function loadPhotos() {
            if (!db || !isAuthReady) {
                console.log("Firestore not ready for loading photos.");
                return;
            }

            // Query public photos collection
            const photosQuery = query(collection(db, `artifacts/${appId}/public/data/photos`), orderBy("timestamp", "desc"));

            onSnapshot(photosQuery, (snapshot) => {
                photoGallery.innerHTML = ''; // Clear existing photos, keeping static ones
                // Re-add static placeholders
                photoGallery.innerHTML += `
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/FFD1DC/6c757d?text=Photo+1" alt="Gallery Image 1" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Love Blooms</p>
                        </div>
                    </div>
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/E0BBE4/6c757d?text=Photo+2" alt="Gallery Image 2" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Adventures Await</p>
                        </div>
                    </div>
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/957DAD/6c757d?text=Photo+3" alt="Gallery Image 3" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Memories Made</p>
                        </div>
                    </div>
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/CBAACB/6c757d?text=Photo+4" alt="Gallery Image 4" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Joyful Moments</p>
                        </div>
                    </div>
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/FFC3A0/6c757d?text=Photo+5" alt="Gallery Image 5" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Side by Side</p>
                        </div>
                    </div>
                    <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                        <img src="https://placehold.co/600x400/FFADAD/6c757d?text=Photo+6" alt="Gallery Image 6" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-xl font-semibold">Our Future</p>
                        </div>
                    </div>
                `;

                snapshot.forEach(doc => {
                    const photo = doc.data();
                    const photoId = doc.id;
                    const timestamp = photo.timestamp ? new Date(photo.timestamp.toDate()).toLocaleString() : 'N/A';
                    const isUploader = photo.uploaderId === currentUserId;

                    const photoElement = `
                        <div class="relative group rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-105">
                            <img src="${photo.url}" alt="Uploaded Photo" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 p-4">
                                <div class="text-white text-center">
                                    <p class="text-lg font-semibold mb-2">Uploaded by: ${photo.uploaderId.substring(0, 8)}...</p>
                                    <p class="text-sm">${timestamp}</p>
                                    ${isUploader ? `<button onclick="deletePhoto('${photoId}', '${photo.fileName}', '${photo.uploaderId}')" class="mt-4 bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-4 rounded-full shadow-md">Delete</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    photoGallery.innerHTML += photoElement;
                });
            }, (error) => {
                console.error("Error listening to photos:", error);
                showModal("Error", "Failed to load photos from the gallery.");
            });
        }

        // Delete photo function
        window.deletePhoto = function(photoDocId, fileName, uploaderId) {
            if (currentUserId !== uploaderId) {
                showModal("Access Denied", "You can only delete photos you have uploaded.");
                return;
            }

            showModal(
                "Confirm Deletion",
                "Are you sure you want to delete this photo? This action cannot be undone.",
                true, // isConfirm
                async () => { // onConfirm callback
                    try {
                        // Delete from Firestore Storage
                        const storagePath = `artifacts/${appId}/public/photos/${uploaderId}/${fileName}`;
                        const storageRef = ref(storage, storagePath);
                        await deleteObject(storageRef);

                        // Delete from Firestore Database
                        await deleteDoc(doc(db, `artifacts/${appId}/public/data/photos`, photoDocId));
                        showModal("Deleted!", "Photo deleted successfully.");
                    } catch (error) {
                        console.error("Error deleting photo:", error);
                        showModal("Error", `Failed to delete photo: ${error.message}`);
                    }
                }
            );
        };

        // Initial load of photos
        if (isAuthReady) {
            loadPhotos();
        }
    </script>
</body>
</html>
